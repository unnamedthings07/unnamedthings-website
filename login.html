<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Identity Verification - Unnamed Things</title>
    <link href="https://fonts.googleapis.com/css2?family=Oswald:wght@400;700&family=Special+Elite&display=swap" rel="stylesheet">
    <style>
        :root { --color-red: #CD201F; --color-black: #050505; --color-gray: #333; }
        * { box-sizing: border-box; }
        
        body {
            background-color: var(--color-black);
            color: #fff;
            font-family: 'Oswald', sans-serif;
            display: flex; justify-content: center; align-items: center;
            min-height: 100vh; margin: 0;
            background-image: radial-gradient(circle at center, #1a1a1a 0%, #000 100%);
        }

        .login-card {
            width: 100%; max-width: 420px;
            padding: 2.5rem;
            border: 1px solid var(--color-gray);
            background: rgba(10, 10, 10, 0.95);
            position: relative;
            box-shadow: 0 0 50px rgba(0,0,0,0.8);
        }
        
        /* Red Glow Border */
        .login-card::before {
            content: ''; position: absolute; top: -1px; left: -1px; right: -1px; bottom: -1px;
            background: linear-gradient(45deg, var(--color-red), transparent, var(--color-red));
            z-index: -1; filter: blur(5px); opacity: 0.4;
        }

        h1 { margin: 0 0 5px 0; letter-spacing: 2px; text-transform: uppercase; color: #fff; text-align: center; }
        .sub-text { font-family: 'Special Elite', cursive; color: #666; font-size: 0.8rem; margin-bottom: 1.5rem; text-align: center; display: block; }

        /* TABS (Login vs Register) */
        .tabs { display: flex; border-bottom: 1px solid var(--color-gray); margin-bottom: 1.5rem; }
        .tab {
            flex: 1; padding: 10px; text-align: center; cursor: pointer;
            font-family: 'Special Elite', cursive; color: #666; transition: all 0.3s;
        }
        .tab.active { color: var(--color-red); border-bottom: 2px solid var(--color-red); }

        /* FORMS */
        .form-group { margin-bottom: 1rem; }
        input {
            width: 100%; padding: 12px; background: #000; border: 1px solid var(--color-gray);
            color: #fff; font-family: 'Special Elite', cursive; outline: none; transition: border 0.3s;
        }
        input:focus { border-color: var(--color-red); }

        /* BUTTONS */
        .btn-main {
            width: 100%; padding: 12px; background: var(--color-red); color: #fff;
            border: none; font-family: 'Oswald', sans-serif; font-size: 1.1rem;
            cursor: pointer; transition: all 0.3s; margin-top: 10px;
        }
        .btn-main:hover { background: #ff4d4d; box-shadow: 0 0 15px rgba(205, 32, 31, 0.4); }

        .btn-google {
            width: 100%; padding: 12px; background: #fff; color: #000;
            border: none; font-family: 'Oswald', sans-serif; font-size: 1rem;
            cursor: pointer; display: flex; align-items: center; justify-content: center; gap: 10px;
            margin-top: 1rem; transition: transform 0.2s;
        }
        .btn-google:hover { transform: scale(1.02); }

        /* UTILS */
        .divider { text-align: center; margin: 1.5rem 0; color: #444; font-size: 0.8rem; position: relative; }
        .divider::before, .divider::after { content: ''; position: absolute; top: 50%; width: 40%; height: 1px; background: #333; }
        .divider::before { left: 0; } .divider::after { right: 0; }

        .link-btn {
            background: none; border: none; color: #666; cursor: pointer;
            font-family: 'Special Elite', cursive; font-size: 0.8rem; margin-top: 10px;
            text-decoration: underline; display: block; width: 100%; text-align: center;
        }
        .link-btn:hover { color: var(--color-red); }

        .error-msg { color: var(--color-red); font-size: 0.9rem; text-align: center; margin-top: 10px; display: none; }
        .success-msg { color: #00ff00; font-size: 0.9rem; text-align: center; margin-top: 10px; display: none; }

        /* HIDDEN SECTIONS */
        .hidden { display: none; }
    </style>
</head>
<body>

    <div class="login-card">
        <h1>IDENTITY VERIFICATION</h1>
        <span class="sub-text">SECURE ARCHIVE ACCESS PROTOCOL</span>

        <div class="tabs">
            <div class="tab active" id="tabLogin">LOGIN</div>
            <div class="tab" id="tabRegister">REGISTER</div>
        </div>

        <form id="loginForm">
            <div class="form-group">
                <input type="email" id="loginEmail" placeholder="OPERATIVE EMAIL" required>
            </div>
            <div class="form-group">
                <input type="password" id="loginPass" placeholder="PASSWORD" required>
            </div>
            <button type="submit" class="btn-main" id="btnLogin">ACCESS SYSTEM</button>
            <button type="button" class="link-btn" id="btnForgot">FORGOT PASSWORD?</button>
        </form>

        <form id="registerForm" class="hidden">
            <p style="color:#aaa; font-size:0.8rem; text-align:center; margin-bottom:1rem;">
                WARNING: EMAIL VERIFICATION REQUIRED.<br>FAKE CREDENTIALS WILL BE PURGED.
            </p>
            <div class="form-group">
                <input type="email" id="regEmail" placeholder="VALID EMAIL ADDRESS" required>
            </div>
            <div class="form-group">
                <input type="password" id="regPass" placeholder="CREATE PASSWORD (MIN 6 CHARS)" required minlength="6">
            </div>
            <div class="form-group">
                <input type="password" id="regPassConfirm" placeholder="CONFIRM PASSWORD" required>
            </div>
            <button type="submit" class="btn-main" id="btnRegister">INITIATE REGISTRATION</button>
        </form>

        <form id="forgotForm" class="hidden">
            <p style="color:#aaa; font-size:0.8rem; text-align:center; margin-bottom:1rem;">
                ENTER EMAIL TO RECEIVE RECOVERY LINK.
            </p>
            <div class="form-group">
                <input type="email" id="forgotEmail" placeholder="RECOVERY EMAIL ADDRESS" required>
            </div>
            <button type="submit" class="btn-main">SEND RESET LINK</button>
            <button type="button" class="link-btn" id="btnBackToLogin">CANCEL</button>
        </form>

        <div id="socialSection">
            <div class="divider">OR</div>
            <button id="btnGoogle" class="btn-google">
                <svg width="18" height="18" viewBox="0 0 24 24"><path fill="currentColor" d="M21.35 11.1h-9.17v2.73h6.51c-.33 3.81-3.5 5.44-6.5 5.44C8.51 19.27 5 16.38 5 12c0-4.1 3.51-7.23 7.14-7.23c2.01 0 3.8.63 5.24 2.07l2.15-2.15C17.2 2.63 15.01 1.75 12.14 1.75c-5.53 0-10 4.7-10 10.5c0 5.79 4.47 10.5 10 10.5c5.07 0 9.42-3.69 9.87-9.61c.09-.94 0-1.57 0-2.04z"/></svg>
                AUTHENTICATE WITH GOOGLE
            </button>
        </div>

        <div id="statusMsg" class="error-msg"></div>
        <div id="successMsg" class="success-msg"></div>

        <a href="index.html" class="link-btn" style="margin-top: 2rem;">// ABORT & RETURN TO SITE</a>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getAuth, 
            signInWithPopup, 
            GoogleAuthProvider, 
            createUserWithEmailAndPassword, 
            signInWithEmailAndPassword, 
            sendEmailVerification, 
            sendPasswordResetEmail,
            signOut
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

        // YOUR CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyDwIMRuv26pcAndpd36EkLbUpSGvh6ptSY",
            authDomain: "unnamed-things-website-70cf7.firebaseapp.com",
            projectId: "unnamed-things-website-70cf7",
            storageBucket: "unnamed-things-website-70cf7.firebasestorage.app",
            messagingSenderId: "293788800527",
            appId: "1:293788800527:web:575a1fd1f60d6361f3357a"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const provider = new GoogleAuthProvider();

        // --- UI ELEMENTS ---
        const tabLogin = document.getElementById('tabLogin');
        const tabRegister = document.getElementById('tabRegister');
        const loginForm = document.getElementById('loginForm');
        const registerForm = document.getElementById('registerForm');
        const forgotForm = document.getElementById('forgotForm');
        const socialSection = document.getElementById('socialSection');
        const statusMsg = document.getElementById('statusMsg');
        const successMsg = document.getElementById('successMsg');

        // --- UI SWITCHING LOGIC ---
        function showMsg(msg, isError = true) {
            statusMsg.style.display = isError ? 'block' : 'none';
            successMsg.style.display = isError ? 'none' : 'block';
            statusMsg.innerText = isError ? msg : '';
            successMsg.innerText = isError ? '' : msg;
        }

        tabLogin.addEventListener('click', () => {
            tabLogin.classList.add('active'); tabRegister.classList.remove('active');
            loginForm.classList.remove('hidden'); registerForm.classList.add('hidden'); forgotForm.classList.add('hidden');
            socialSection.classList.remove('hidden'); showMsg('', false);
        });

        tabRegister.addEventListener('click', () => {
            tabRegister.classList.add('active'); tabLogin.classList.remove('active');
            registerForm.classList.remove('hidden'); loginForm.classList.add('hidden'); forgotForm.classList.add('hidden');
            socialSection.classList.remove('hidden'); showMsg('', false);
        });

        document.getElementById('btnForgot').addEventListener('click', () => {
            loginForm.classList.add('hidden'); forgotForm.classList.remove('hidden'); socialSection.classList.add('hidden');
        });

        document.getElementById('btnBackToLogin').addEventListener('click', () => {
            forgotForm.classList.add('hidden'); loginForm.classList.remove('hidden'); socialSection.classList.remove('hidden');
        });

        // --- 1. LOGIN LOGIC ---
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('loginEmail').value;
            const pass = document.getElementById('loginPass').value;
            const btn = document.getElementById('btnLogin');

            btn.innerText = "VERIFYING CREDENTIALS...";
            btn.disabled = true;

            try {
                const userCredential = await signInWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // CHECK IF EMAIL IS VERIFIED
                if (user.emailVerified) {
                    showMsg("ACCESS GRANTED.", false);
                    setTimeout(() => window.history.back(), 1000); // Redirect back
                } else {
                    await signOut(auth); // Force logout
                    showMsg("ACCESS DENIED: EMAIL NOT VERIFIED. CHECK YOUR INBOX.");
                    btn.innerText = "ACCESS SYSTEM";
                    btn.disabled = false;
                }
            } catch (error) {
                showMsg("LOGIN FAILED: " + error.message.replace("Firebase:", "").trim());
                btn.innerText = "ACCESS SYSTEM";
                btn.disabled = false;
            }
        });

        // --- 2. REGISTER LOGIC (With Verification) ---
        registerForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('regEmail').value;
            const pass = document.getElementById('regPass').value;
            const confirm = document.getElementById('regPassConfirm').value;
            const btn = document.getElementById('btnRegister');

            if (pass !== confirm) { showMsg("ERROR: PASSWORDS DO NOT MATCH"); return; }

            btn.innerText = "CREATING IDENTITY...";
            btn.disabled = true;

            try {
                const userCredential = await createUserWithEmailAndPassword(auth, email, pass);
                const user = userCredential.user;

                // SEND VERIFICATION EMAIL
                await sendEmailVerification(user);
                
                // Sign out immediately so they can't log in yet
                await signOut(auth);

                showMsg("REGISTRATION SUCCESSFUL. VERIFICATION LINK SENT TO EMAIL. PLEASE VERIFY BEFORE LOGGING IN.", false);
                
                // Reset UI
                registerForm.reset();
                btn.innerText = "INITIATE REGISTRATION";
                btn.disabled = false;

            } catch (error) {
                showMsg("REGISTRATION ERROR: " + error.message.replace("Firebase:", "").trim());
                btn.innerText = "INITIATE REGISTRATION";
                btn.disabled = false;
            }
        });

        // --- 3. FORGOT PASSWORD LOGIC ---
        forgotForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const email = document.getElementById('forgotEmail').value;
            
            try {
                await sendPasswordResetEmail(auth, email);
                showMsg("RECOVERY LINK SENT. CHECK INBOX.", false);
                forgotForm.reset();
            } catch (error) {
                showMsg("ERROR: " + error.message);
            }
        });

        // --- 4. GOOGLE AUTH ---
        document.getElementById('btnGoogle').addEventListener('click', () => {
            signInWithPopup(auth, provider).then(() => {
                showMsg("GOOGLE AUTH VERIFIED.", false);
                setTimeout(() => window.history.back(), 1000);
            }).catch((error) => {
                showMsg("AUTH ERROR: " + error.message);
            });
        });

    </script>
</body>
</html>